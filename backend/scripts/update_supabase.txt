-- Update sequence pointers to prevent "Key already exists" errors
-- Run this after inserting sample data

-- Core Learning Content
SELECT setval('topics_id_seq', (SELECT MAX(id) FROM topics), true);
SELECT setval('lessons_id_seq', (SELECT MAX(id) FROM lessons), true);
SELECT setval('lesson_sections_id_seq', (SELECT MAX(id) FROM lesson_sections), true);
SELECT setval('questions_id_seq', (SELECT MAX(id) FROM questions), true);

-- Vocabulary
SELECT setval('vocabs_id_seq', (SELECT MAX(id) FROM vocabs), true);
SELECT setval('user_words_id_seq', (SELECT MAX(id) FROM user_words), true);

-- User Management
SELECT setval('users_id_seq', (SELECT MAX(id) FROM users), true);
SELECT setval('user_points_id_seq', (SELECT MAX(id) FROM user_points), true);
SELECT setval('roles_id_seq', (SELECT MAX(id) FROM roles), true);
SELECT setval('user_roles_id_seq', (SELECT MAX(id) FROM user_roles), true);
SELECT setval('user_xp_log_id_seq', (SELECT MAX(id) FROM user_xp_log), true);
SELECT setval('user_info_id_seq', (SELECT MAX(id) FROM user_info), true);

-- Progress Tracking
SELECT setval('user_progress_id_seq', (SELECT MAX(id) FROM user_progress), true);

-- Community/Social
SELECT setval('posts_id_seq', (SELECT MAX(id) FROM posts), true);
SELECT setval('post_comments_id_seq', (SELECT MAX(id) FROM post_comments), true);
SELECT setval('post_likes_id_seq', (SELECT MAX(id) FROM post_likes), true);
SELECT setval('friends_id_seq', (SELECT MAX(id) FROM friends), true);
SELECT setval('friend_requests_id_seq', (SELECT MAX(id) FROM friend_requests), true);

-- Daily Missions
SELECT setval('daily_missions_id_seq', (SELECT MAX(id) FROM daily_missions), true);
SELECT setval('user_daily_missions_id_seq', (SELECT MAX(id) FROM user_daily_missions), true);

-- Reports
SELECT setval('reports_id_seq', (SELECT MAX(id) FROM reports), true);

-- Leaderboard
SELECT setval('leaderboard_snapshots_id_seq', (SELECT MAX(id) FROM leaderboard_snapshots), true);

-- Verify the sequences are updated correctly
SELECT 'topics_id_seq' as sequence_name, last_value FROM topics_id_seq
UNION ALL SELECT 'lessons_id_seq', last_value FROM lessons_id_seq
UNION ALL SELECT 'lesson_sections_id_seq', last_value FROM lesson_sections_id_seq
UNION ALL SELECT 'questions_id_seq', last_value FROM questions_id_seq
UNION ALL SELECT 'vocabs_id_seq', last_value FROM vocabs_id_seq
UNION ALL SELECT 'user_words_id_seq', last_value FROM user_words_id_seq
UNION ALL SELECT 'users_id_seq', last_value FROM users_id_seq
UNION ALL SELECT 'user_points_id_seq', last_value FROM user_points_id_seq
UNION ALL SELECT 'roles_id_seq', last_value FROM roles_id_seq
UNION ALL SELECT 'user_roles_id_seq', last_value FROM user_roles_id_seq
UNION ALL SELECT 'user_xp_log_id_seq', last_value FROM user_xp_log_id_seq
UNION ALL SELECT 'user_info_id_seq', last_value FROM user_info_id_seq
UNION ALL SELECT 'user_progress_id_seq', last_value FROM user_progress_id_seq
UNION ALL SELECT 'posts_id_seq', last_value FROM posts_id_seq
UNION ALL SELECT 'post_comments_id_seq', last_value FROM post_comments_id_seq
UNION ALL SELECT 'post_likes_id_seq', last_value FROM post_likes_id_seq
UNION ALL SELECT 'friends_id_seq', last_value FROM friends_id_seq
UNION ALL SELECT 'friend_requests_id_seq', last_value FROM friend_requests_id_seq
UNION ALL SELECT 'daily_missions_id_seq', last_value FROM daily_missions_id_seq
UNION ALL SELECT 'user_daily_missions_id_seq', last_value FROM user_daily_missions_id_seq
UNION ALL SELECT 'reports_id_seq', last_value FROM reports_id_seq
UNION ALL SELECT 'leaderboard_snapshots_id_seq', last_value FROM leaderboard_snapshots_id_seq;